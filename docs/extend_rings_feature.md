# 偏置环功能使用文档

Summer-GDS 工具现已支持"偏置环"功能，该功能可以基于现有环阵列，快速创建扩展或缩窄的偏置环，常用于半导体工艺中的刻蚀/光刻偏置设计。

## 功能特点

1. **一键偏置**：可以在现有环阵列基础上，一键生成扩展或缩窄后的环阵列
2. **保持倒角特性**：自动调整倒角半径，保持倒角圆与边缘的相对位置关系
3. **支持多层偏置**：可以在不同图层创建不同偏置量的环阵列
4. **支持多半径倒角**：与普通环阵列一样，支持每个角设置独立的倒角半径

## 使用方法

### 通过Web界面

1. 在Web GUI中，点击"添加形状"按钮
2. 从弹出的形状选择对话框中，选择"偏置环"
3. 在表单中填写以下信息：
   - 名称：为该偏置环命名
   - 图层：指定GDS图层编号和数据类型
   - 顶点坐标：指定初始多边形的顶点坐标
   - 环宽度：指定原始环的宽度
   - 环间距：指定原始环之间的间距
   - 环数量：指定环的数量
   - 偏置宽度：指定偏置量（正值代表外扩，负值代表内缩）
   - 倒角类型和半径：指定倒角类型和半径

4. 如需设置每个角独立的倒角半径，点击"切换到半径列表"按钮，输入逗号分隔的半径值

### 与派生图形的联动与覆盖

当环阵列作为基础图形被派生（例如通过“扩大/缩小”功能生成偏置版本）时，以下字段会自动继承基础图形的最新设置并在 Web GUI 中实时同步：

- `ring_width`（环宽度）
- `ring_space`（环间距）
- `ring_num`（环数量）

如果需要在派生图形上对这些字段进行独立调整，只需在派生卡片中编辑对应输入框。系统会将其标记为“已覆盖”，并在后续基础图形变更时保持派生值不被重写。如需恢复继承状态，再次输入基础值或手动删除派生图形即可。

### 通过配置文件

在YAML配置文件中，可以按如下格式添加偏置环：

```yaml
shapes:
  - type: extend_rings
    name: 偏置环示例
    layer: [2, 0]
    vertices: "0,0:100,0:100,100:0,100"
    ring_width: 10
    ring_space: 2
    ring_num: 3
    extend_width: 5  # 正值向外扩展，负值向内缩窄
    fillet:
      type: arc
      radius: 5  # 单一倒角半径
      # 或使用半径列表
      # radii: [5, 8, 3, 10]  # 每个角使用不同的倒角半径
    zoom: [0, 0]  # 额外的整体缩放调整 [外径缩放, 内径缩放]
```

## 参数说明

- **ring_width**：原始环宽度（微米）
- **ring_space**：原始环间距（微米）
- **ring_num**：环的数量
- **extend_width**：偏置宽度（微米）
  - 正值：向外扩展
  - 负值：向内缩窄
- **fillet**：倒角配置
  - **type**：倒角类型，支持"arc"（圆弧）和"none"（无倒角）
  - **radius**：单一倒角半径
  - **radii**：多半径列表（每个角的倒角半径，按顶点顺序）
- **zoom**：额外的缩放调整 [外径缩放, 内径缩放]

## 示例

参考 `/web_gui/example_extend_rings.yaml` 中的示例配置，展示了不同偏置设置下的效果。

## 技术实现说明

偏置环功能通过调整以下参数实现：

1. 调整原始环的宽度（对于负偏置）
2. 调整zoom_config参数（用于整体偏移）
3. 同步调整倒角半径，保证倒角圆与边缘的相对位置关系

## 注意事项

1. 偏置宽度不宜过大，避免超过原环宽度的一半（特别是负偏置）
2. 使用多半径倒角时，确保半径列表长度与顶点数量匹配
3. 过大的负偏置可能导致环宽度过小，影响渲染效果 
