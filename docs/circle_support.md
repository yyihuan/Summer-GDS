# Summer-GDS 圆形支持功能详细说明

## 📋 功能概述

Summer-GDS现在支持通过Web GUI界面创建圆形图案。用户可以通过设置圆心坐标、半径和精度参数来定义圆形，系统会自动生成对应的多边形顶点坐标。

## 🎯 使用方法

### 1. 启动Web GUI
```bash
./start_web_gui.sh
```

### 2. 创建圆形
1. 点击"添加形状"按钮
2. 选择"多边形"或"环阵列"类型
3. 在"定义方式"下拉菜单中选择"圆形"
4. 设置圆形参数：
   - **圆心X (μm)**：圆心的X坐标
   - **圆心Y (μm)**：圆心的Y坐标
   - **半径 (μm)**：圆的半径
   - **精度**：用于近似圆形的多边形顶点数量

### 3. 参数说明

#### 圆心坐标 (center_x, center_y)
- 单位：微米 (μm)
- 支持小数，精度到0.001μm
- 可以为负值
- 默认值：(0, 0)

#### 半径 (radius)
- 单位：微米 (μm)
- 必须大于0.001μm
- 支持小数输入
- 典型范围：1-10000μm

#### 精度 (segments)
- 表示用于近似圆形的多边形边数
- 范围：8-256
- 默认值：64
- 更高的精度 = 更平滑的圆形 + 更多的顶点

## 📊 精度选择指南

### 精度误差对比表

| 精度值 | 顶点数 | 10μm圆误差 | 100μm圆误差 | 1000μm圆误差 | 处理速度 | 文件大小 |
|--------|--------|------------|-------------|--------------|----------|----------|
| 8      | 8      | 0.038μm    | 0.38μm      | 3.8μm        | 最快     | 最小     |
| 16     | 16     | 0.010μm    | 0.098μm     | 0.98μm       | 很快     | 小       |
| 32     | 32     | 0.002μm    | 0.024μm     | 0.244μm      | 快       | 小       |
| **64** | **64** | **0.001μm** | **0.0098μm** | **0.098μm** | **中等** | **中等** |
| 128    | 128    | 0.0002μm   | 0.0024μm    | 0.024μm      | 慢       | 大       |
| 256    | 256    | 0.00006μm  | 0.0006μm    | 0.006μm      | 很慢     | 很大     |

### 误差计算公式
```
最大误差 = 半径 × (1 - cos(π/精度值))
```

### 应用场景推荐

#### 64精度（推荐默认值）
- **适用**：90%的应用场景
- **优势**：性能和精度的最佳平衡
- **误差**：对100μm圆形误差约0.01μm
- **用途**：一般电路设计、标准器件

#### 32精度（快速模式）
- **适用**：大型图形、批量处理
- **优势**：处理速度快、文件小
- **误差**：对100μm圆形误差约0.024μm
- **用途**：粗略设计、原型验证

#### 128精度（高精度模式）
- **适用**：精密器件、高质量要求
- **优势**：极高的圆形近似精度
- **误差**：对100μm圆形误差约0.002μm
- **用途**：光学器件、高频电路

#### 256精度（超高精度）
- **适用**：特殊精密应用
- **缺点**：处理慢、文件大
- **误差**：对100μm圆形误差约0.0006μm
- **用途**：极致精度要求的场合

## 🔧 技术实现

### 顶点生成算法
```javascript
function generateCircleVertices(centerX, centerY, radius, segments = 64) {
    const vertices = [];
    for (let i = 0; i < segments; i++) {
        const angle = (2 * Math.PI * i) / segments;
        const x = centerX + radius * Math.cos(angle);
        const y = centerY + radius * Math.sin(angle);
        vertices.push(`${x.toFixed(3)},${y.toFixed(3)}`);
    }
    return vertices.join(':');
}
```

### 数据流程
1. 用户在Web GUI中输入圆形参数
2. JavaScript实时生成圆形顶点坐标
3. 顶点坐标填入vertices字段
4. 保存为标准的YAML配置
5. 后端处理时与普通多边形相同

## 📝 配置示例

### 简单圆形
```yaml
shapes:
  - type: "polygon"
    name: "Circle_10um"
    vertices: "10.000,0.000:9.951,0.980:9.808,1.951:9.569,2.903:..."
    layer: [1, 0]
    zoom: 0
    fillet:
      type: "none"
```

### 带倒角的圆形
```yaml
shapes:
  - type: "polygon"
    name: "Rounded_Circle"
    vertices: "50.000,0.000:49.756,4.902:49.039,9.755:..."
    layer: [1, 0]
    zoom: 0
    fillet:
      type: "arc"
      radius: 2.0
```

### 圆形环阵列
```yaml
shapes:
  - type: "rings"
    name: "Circle_Rings"
    vertices: "20.000,0.000:19.902,1.960:19.616,3.902:..."
    ring_width: 2
    ring_space: 1
    ring_num: 5
    layer: [2, 0]
    zoom: 0
```

## ⚠️ 使用注意事项

### 参数限制
1. **半径**：必须大于0.001μm
2. **精度**：范围8-256，系统会自动调整超出范围的值
3. **坐标**：支持负值，但要注意GDS坐标系统
4. **精度**：过高的精度会显著增加处理时间

### 性能考虑
1. **大半径圆形**：建议使用64或32精度
2. **批量生成**：避免使用过高精度
3. **文件大小**：高精度圆形会增加GDS文件大小
4. **内存使用**：大量高精度圆形可能消耗较多内存

### 兼容性说明
1. **仅Web GUI支持**：圆形定义仅在Web界面可用
2. **保存格式**：最终保存为标准顶点坐标
3. **后端兼容**：后端无需修改，完全兼容现有处理流程
4. **版本兼容**：生成的配置文件与旧版本完全兼容

## 🎯 最佳实践

### 精度选择策略
```
半径 < 10μm    → 64或128精度
半径 10-100μm  → 64精度
半径 100-1000μm → 32或64精度
半径 > 1000μm  → 32精度
```

### 工艺考虑
- **光刻精度**：通常0.1-1μm，64精度已远超制造精度
- **测量精度**：通常0.01-0.1μm，128精度可满足测量要求
- **设计裕量**：建议误差控制在工艺精度的1/10以内

### 调试技巧
1. **参数验证**：先用小参数测试
2. **视觉检查**：使用GDS查看器检查生成结果
3. **误差估算**：使用提供的误差公式预估精度需求
4. **性能测试**：在实际环境中测试处理速度

## 🔮 未来计划

### 短期改进
- [ ] 元数据保存：记录原始圆形参数
- [ ] 反向编辑：从配置文件恢复圆形参数
- [ ] 参数预设：常用圆形尺寸的快速模板

### 长期规划
- [ ] 椭圆支持：扩展到椭圆图形
- [ ] 圆弧支持：支持扇形和圆弧
- [ ] 实时预览：可视化显示圆形外观
- [ ] 批量生成：支持圆形阵列功能

---

**版本**: 1.0
**更新时间**: 2024年10月14日
**状态**: 已实现基础功能，持续改进中